<!DOCTAPE html>
<html>
<head>
<meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<style>
body{margin:0;padding:0;background:green}
button{
background:#96b52d;
font-size:24px
width:70;height:70;
}
div.bu{
position:absolute;bottom:10%;
}
button.bu{opacity:80%;user-select: none;}


#tool{
position:fixed;top:10;right:10;color:#fff;font-size:32px;background:black;opacity:80%
}
#set{
    display:none;
    max-width:500px;width:90%;
    height:300px;
    position:fixed;top:0;left:0;right:0;bottom:0;
    margin:auto auto;
    background:#ffffff;
    padding:5px;
    border:1px solid #000;border-radius:10px;-moz-border-radius:10px;
    overflow: scroll;
    opacity:50%
}

input[type=checkbox]{
visibility: hidden;
}
input[type=checkbox]::after{
content:" ";
display:block;
width:40px;
height:40px;
background:green;
}
input[type=checkbox]:checked::after{
background:blue;
}

hr {
    height:1px;
    border:none;
    border-top:3px dashed #df0000;
}
.dt {
    background:#cfa;/*(#000)。#efff6d黄)*/
    box-sizing:boder-box;
    left:0;
    right:0;
    top:0;
    position:absolute;
    padding:0px;
    color:#f90;/*f00*/
    height:80px;
}
.dbo1 {
    max-width:925px;width:90%;
    border:1px solid #f90;
    border-radius:10px;-moz-border-radius:10px;
    padding:10px;
    color:#f90;
    background:#aff;
    margin:0 auto;
    /*flex-wrap:wrap;
    display:flex;*/
}
/*tool为悬浮的工具栏*/
.tool{
    /*display:none;*/
    position:fixed;
    top:15;right:15;
    background:;opacity:50%;
    /*width:55px;height:50px;*/
    transition:1s;
}
.showtool{
    opacity:90%;
}
.showtool .sp1{
    transition:1s;
}
.tool1{
    border:2px solid #ff0000;
    background:#FFFFFF;
    text-align:center;
    width:50px;height:50px;
    box-sizing:border-box;
    line-height:50px;
}
.tool2{
    display:none;
    transition:1s;
    opacity:10%;
}
.ticon{/*工具栏图标*/
    font-size:45px;
    font-weight:bold;
    color:#333333;
}
.tool:hover .tool1{
    display:block;
    opacity:90%;
}
.tool:hover .sp1{
    transform: rotate(180deg);
    -ms-transform: rotate(180deg); /* IE 9 */
    -webkit-transform: rotate(180deg); /* Safari and Chrome */
}
/*set是设置弹窗*/
#set{
    display:none;
    max-width:500px;width:90%;
    height:300px;
    position:fixed;top:0;left:0;right:0;bottom:0;
    margin:auto auto;
    background:#ffffff;
    padding:5px;
    border-radius:10px;-moz-border-radius:10px;
    overflow: scroll;
}
#set .hs{
    float:right;
}
div.sesw{
    border-bottom:1px solid #ccc;
    height:40px;
}
/*.switch开关*/
.switch {
  position: relative;
  display: inline-block;
  width: 56px;
  height: 30px;
  float:right;
}
.switch input {
    display:none;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}
.slider:before {
  position: absolute;
  content: "";
  height: 22px;
  width: 22px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}
input:checked + .slider {
  /*background-color: #ff0000;*/
  background-color: #2196F3;
}
input:focus + .slider {
  box-shadow: 0 0 1px #2196F3;
}
input:checked + .slider:before {
  -webkit-transform: translateX(26px);
  -ms-transform: translateX(26px);
  transform: translateX(26px);
}
.slider.round {
  border-radius: 34px;
}
.slider.round:before {
  border-radius: 50%;
}
/*字体*/
/*@font-face {
    font-family: pigfont;
    src: url()
}*/
</style>
<!--link rel="stylesheet" href="style.css"-->
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
</head>
<body>
<!--html-->
<noscript>noscript</noscript>
<div id="tool" onclick="tool('block')"><i class="fa fa-gear"></i></div>
<div id="set"></div>
<div class="bu">
<button class="bu" id="bu1">bu1</button>
<button class="bu" id="bu2">bu2</button>
<button class="bu" id="bu3">bu3</button>
<button class="bu" id="bu4">bu4</button>
<button class="bu" id="bu5">bu5</button>
<button class="bu" id="bu6">bu6</button>
<button class="bu" id="bu7">bu7</button>
<button class="bu" id="bu8">bu8</button>
<button class="bu" id="bu9">bu9</button>
<button onclick="document.documentElement.webkitRequestFullScreen();">全屏</button>
<input type="range" min="0" max="10" step="1" oninput="lookat(0,0,(this.value-5)*0.1);this.value=5;">
<input type="range" min="0" max="10" step="1" oninput="lookat((this.value-5)*10,0,0);this.value=5;">
<input type="range" min="0" max="10" step="1" oninput="lookat(0,(this.value-5)*10,0);this.value=5;">
<input type="text" onchange="eval(this.value)">
<input type="checkbox" id="check">
</div>

<canvas id="canvas" width="1200" height="675" style="width:100vw;">你的浏览器不支持canvas</canvas>
<script src="matter.js"></script>
<!-- <script src="matter.min.js"></script> -->
<!--script src="matter-spring.js"></script-->
<script src="tool.js"></script>
<script>
function dgbyid(idid){
return document.getElementById(idid)
}
if(true){dgbyid("set").innerHTML='<div style="text-align:center;">设置<div class="hs"><a onclick="tool(\'none\')"><i class="fa fa-times"></i></a></div></div><hr style="height:1px;border:none;border-top:1px solid #ccc;"/><div class="sesw">开关示例<label class="switch"><input id="seta" type="checkbox" onchange="timesp()"><div class="slider round"></div></label><div id="log"></div></div>';tool("block")}
function tool(display){
dgbyid("set").style.display=display;
}

//matter0.19
// module模块 aliases
var Engine = Matter.Engine,
    Render = Matter.Render,
    Runner = Matter.Runner,
    Bodies = Matter.Bodies,
    Constraint = Matter.Constraint,//约束
    Composite = Matter.Composite,
    Composites = Matter.Composites,
    Body = Matter.Body,
    MouseConstraint = Matter.MouseConstraint,
    Mouse = Matter.Mouse,
    Events = Matter.Events,
    Example = Matter.Example;
    
//Matter.use('matter-springs');//弹簧插件

// create an engine
var engine = Engine.create();

// create a renderer
var render = Render.create({
    canvas: dgbyid("canvas"),
    //element: document.body,
    engine: engine,
    options: {
        width: 1200,
        height: 675,
        background:"url(https://s1.imagehub.cc/images/2023/05/14/Night_Sky_Texture.png)",
        hasBounds:true,
        showAngleIndicator: true,
        showDebug:true,
        showIds: true,
         wireframes: true//线框模式
    }
});



</script>

<script src="options.js"></script>
<!--/*  贴图等  */-->

<script>
var lattice;lattice=100;
var thingsp={
  thingss:[],
  thingssxy:[],
  thingssxyx:[],
  thingssxyy:[]
}
var boxsp={
  boxss:[],
  boxssxy:[],
  boxssxyx:[],
  boxssxyy:[]
}
class Things {
  constructor(xy,radius,rd) {
    this.xy = xy;
    this.radius=radius;
    this.render = rd;
    this.body = undefined;
    this.loop = undefined;
    this.loopdo = undefined;
  }
  g(){
    return {xy:this.xy,
    radius:this.radius,
    render:this.render,
    body:this.body,
    loop:this.loop,
    loopdo:this.loopdo}
  }
  addbd(xy) {
    thingsp.thingss.push(this.body);
    thingsp.thingssxy.push(xy.x+","+xy.y);
    thingsp.thingssxyx.push((xy.x+1)+","+xy.y);
    thingsp.thingssxyy.push(xy.x+","+(xy.y+1));
    return this.body;
  }
  follow(){
    slookat.x=this.body.position.x;
    slookat.y=this.body.position.y;
  }
  start(){
    this.loop=setTimeout(this.loopdo,100);
  }
  stop(){
    clearTimeout(this.loop);
  }
}
class Box extends Things {
  constructor(xy,rd) {
    super(xy,undefined,rd);
  }
  create() {
    this.body=Bodies.rectangle(this.xy.x*lattice, this.xy.y*lattice, 1*lattice, 1*lattice, this.render)
    boxsp.boxss.push(this.body);
    boxsp.boxssxy.push(this.xy.x+","+this.xy.y);
    boxsp.boxssxyx.push((this.xy.x+1)+","+this.xy.y);
    boxsp.boxssxyy.push(this.xy.x+","+(this.xy.y+1));
    return this.body;
  }
}
class Circle extends Things {
  constructor(xy,radius,rd) {
    super(xy,radius,rd);
  }
  create() {
    this.body=Bodies.circle(this.xy.x*lattice, this.xy.y*lattice, this.radius, this.render);
    let curobj=this;
    this.loopdo=function(){addforce(curobj.body,0.44);curobj.start();};
    return this.addbd(this.xy);
  }
}
class Wheel extends Things {
  constructor(xy,range,rd) {
    super(xy,undefined,rd);
    this.range=range;
  }
  create() {
    this.body=wwheel(this.xy.x*lattice, this.xy.y*lattice, 8.5, 58, 34, this.render.wsjx.render, this.render.wcircle.render);
    logs(Composite.allBodies(this.body)[0].position.y)
    Composite.rotate(this.body, this.range, {x:1,y:5}, true)
    return this.addbd(this.xy);
  }
}
class Rocket extends Things {
  constructor(xy,range,rd) {
    super(xy,undefined,rd);
    this.range=range;
  }create() {
    this.body=undefined;
    this.loopdo=function(){
      Body.setVelocity( this.body, {x: 0, y: -20});
      curobj.start();
    }
  }
}
class Dpen extends Things {
  constructor(xy,rd) {
    super(xy,undefined,rd);
  }create() {
    this.body=Bodies.polygon((this.xy.x+0.25)*lattice, this.xy.y*lattice, 3, 50, this.render);
    return this.addbd(this.xy);
  }
  start(){
    addforce(this.body,0.44);
  }
}
function thingsadd(things){things.create();}
  try{
var dpen=new Dpen({x:0,y:0},toptions.dp0).create()
  new Box({x:1,y:0},toptions.febox0).create()
  new Box({x:2,y:0},toptions.febox0).create()
  var b1=new Box({x:3,y:0},toptions.febox0);var b2=b1.create()
//b1.start()
//Matter.Events.on(b2, "click", function(e){logs(e)})
new Wheel({x:1,y:1},0,toptions.muwheel0).create();
var wheel=new Wheel({x:3,y:1},0,toptions.muwheel0).create();
var pig00=new Circle({x:2,y:0},45,toptions.pig0)
var pig0=pig00.create()

  }catch(e){logs(e)}

var bodyss=thingsp.thingss.concat(boxsp.boxss);



//数组内双向对比，赋值重复出现的值。

//连接框与其内物
function compareAr(arr1, arr2, rearr1) {
  return arr1.filter((v) => {
    return arr2.indexOf(v) !== -1;
  });
}
for(var i=0,b=compareAr(boxsp.boxssxy, thingsp.thingssxy);i<b.length;i++){
    let group=Body.nextGroup(true);
    let b1=boxsp.boxss[boxsp.boxssxy.indexOf(b[i])];
    let b2=thingsp.thingss[thingsp.thingssxy.indexOf(b[i])];
    b1.collisionFilter.group=group;
    b2.collisionFilter.group=group;
    bodyss.push(createcst(b1,b2,0,1,1));
} 

//var c0=boxsp.boxssxy.map(boxsp.boxssxy => ({...boxsp.boxssxy, x: boxsp.boxssxy.x + 1 }));
//var d0=boxsp.boxssxy.map(boxsp.boxssxy => ({...boxsp.boxssxy,y:boxsp.boxssxy.y+1}));

for(var i=0,c=compareAr(boxsp.boxssxy,boxsp.boxssxyx);i<c.length;i++){
    bodyss=bodyss.concat(connectAB(boxsp.boxss[boxsp.boxssxy.indexOf(c[i])],boxsp.boxss[boxsp.boxssxyx.indexOf(c[i])],{x:-30,y:0},1));
}//x轴连接框框
for(var i=0,d=compareAr(boxsp.boxssxy,boxsp.boxssxyy);i<d.length;i++){
    bodyss=bodyss.concat(connectAB(boxsp.boxss[boxsp.boxssxy.indexOf(d[i])],boxsp.boxss[boxsp.boxssxyy.indexOf(d[i])],{x:0,y:-30},1));
}//y轴连接框框
try{bodyss=bodyss.concat(connectAB(b2,Composite.allBodies(wheel)[0],{x:0,y:30},1));
bodyss=bodyss.concat(connectAB(boxsp.boxss[boxsp.boxssxy.indexOf("1,0")],Composite.allBodies(thingsp.thingss[thingsp.thingssxy.indexOf("1,1")])[0],{x:0,y:30},1));
bodyss=bodyss.concat(connectAB(boxsp.boxss[boxsp.boxssxy.indexOf("1,0")],thingsp.thingss[thingsp.thingssxy.indexOf("0,0")],{x:-30,y:0},1));
}catch(e){logs(e)}
//bodyss=bodyss.concat(connectAB());
//function duplicates(arr) {
//    return arr.filter((e,i) => arr.indexOf(e)!==arr.lastIndexOf(e) && arr.indexOf(e)===i);
//}


function wwheel(xx, yy, width, height, wheelSize, objectB, objectW) {
    yy=yy-30;
    
    let Body = Matter.Body,
        Bodies = Matter.Bodies,
        Composite = Matter.Composite,
        Constraint = Matter.Constraint;

    var group = Body.nextGroup(true),
        wheelBase = 60,
        wheelAOffset = -height * 0.5 + wheelBase,
        wheelXOffset = 0;
    
    objectB=objectB || {};
    objectW=objectW || {};
    let mwheel0 = Composite.create({ label: 'mwheel0' }),
        body = Bodies.trapezoid(xx, yy, width, height, -10, {
            render:objectB,
            collisionFilter: {
                group: group
            }
            
            //,chamfer: {radius: height * 0.5},density: 0.0002
        });

    let wheelA = Bodies.circle(xx + wheelXOffset, yy + wheelAOffset, wheelSize, { 
        render:objectW,
        collisionFilter: {
            group: group
        },
        friction: 0.5
    });

    let axelA = Constraint.create({
        bodyA: wheelA,
        bodyB: body,
        pointB: { x: wheelXOffset, y: wheelAOffset },
        stiffness: 1,
        length: 0
    });
                    
    
    Composite.addBody(mwheel0, body);
    Composite.addBody(mwheel0, wheelA);
    Composite.addConstraint(mwheel0, axelA);

    return mwheel0;
};//生成轮子

function createcst(bodya,bodyb,move,stiffness,angularStiffness,length,movem){
    //create new Constraint
    let xx = 0,
        yy = 0,
        xb=0,
        yb=0;
    movem=movem || 20
    return Constraint.create({
        pointA: { x: xx, y: yy },
        pointB: { x: xb, y: yb },
        bodyA: bodya,
        bodyB: bodyb,
        // stiffness: stiffness,
        // angularStiffness: 1,
        // angleAStiffness: 1,
        // angleBStiffness: 1,
        damping: 0,
        length: length,
        type: 'constraint'
    });
}
function createcst2(bodya,bodyb,pointa,stiffness,angularStiffness,length){
    //create new Constraint
    return Constraint.create({
        pointA: pointa,
        pointB: {
            x: pointa.y===30||-30 ? -pointa.x : -pointa.y,
            y: pointa.x===30||-30 ? -pointa.y : -pointa.x
        },
        bodyA: bodya,
        bodyB: bodyb,
        stiffness: stiffness,
        angularStiffness: angularStiffness,
        length: length,
        type: 'constraint'
    });
}

function connectAB(bodya,bodyb,pointa,stiffness){
    if(pointa.x!==0){xx=pointa.x;xb=xx;yy=20;yb=-20;}
    else{xx=20;xb=-20;yy=pointa.y;yb=yy;}
    return [createcst2(bodya,bodyb,{x:xx,y:yy},stiffness,0.7),
    createcst2(bodya,bodyb,pointa,stiffness,0.7),
    createcst2(bodya,bodyb,{x:xb,y:yb},stiffness,0.7)]
}
/*try{
var mouse = Mouse.create(render),
mouseConstraint = MouseConstraint.create(engine, {
    mouse: mouse,
    constraint: {
        stiffness: 0.2,
        render: {
            visible: false
        }
    }
});
Composite.add(engine.world, mouseConstraint);
render.mouse = mouse;
}catch(e){logs(e)}*/

//var ww=wwheel(0,3*lattice,9,58,34,toptions.muwheel0.wsjx.render,toptions.muwheel0.wcircle.render);
//Composite.rotate( ww, Math.PI/4, {x:50,y:50}, false);
//Composite.add(engine.world, ww)

var we=wwheel(2*lattice,3*lattice,8.5,58,34,toptions.muwheel0.wsjx.render,toptions.muwheel0.wcircle.render);
//Composite.rotate( we, Math.PI/2, {x:0,y:0}, false);


// createing 创建物品
//var spring = Bodies.rectangle(200, 100, 70, 100, toptions.spring);//0弹簧
var ground = [
  Bodies.rectangle(400, 1110, 9910, 60, { isStatic: true }),
  Bodies.rectangle(400, 610, 910, 70, { isStatic: true })
];
//地面
//var dpen=Matter.Bodies.polygon(1.25*lattice, 2*lattice, 3, 50, toptions.dp0)

var circleth = Bodies.circle(400, 300, 30, {density: 0.005});
//Composite.add(engine.world, [circleth]);

/*****/var particleOptions = {
/**/    friction: 0.05,
/**/    frictionStatic: 0.1,
/**/    render: { visible: true } 
/**/};//圆摩擦力
/**/var constraintOptions = {
/**/    render: { visible: true }
/**/};//约束线
/*****/var softBody = Composites.softBody(100, 400, 20, 4, 0, 5, true, 15, particleOptions, constraintOptions);//软体

/*Matter.Plugin.springs = [
  Spring.create({
    bodyA: circleth, 
    pointB: {x: 200, y: 200}, 
    stiffness: 0.5, 
    damping: 1
  })
];//弹簧*/


//堆彻
// var stack = Composites.stack(550, 100, 4, 3, 1, 0, function(x, y) {
  // return Bodies.rectangle(x, y, 40, 20, {
    // render: {
      // fillStyle: 'orange',
      // strokeStyle: 'black'
    // }
  // });
//});//堆彻



//mwheel[1]=Composite.create({
//    label: 'Mwheel',
//    parent:engine.world
//});

    /**添加鼠标控制*/
    /*var mouseConstraint = Matter.MouseConstraint.create(engine, {
        element: document.body
    });*/


var mwheel2 = wwheel(3*lattice,3*lattice,8.5,58,34,toptions.muwheel0.wsjx.render,toptions.muwheel0.wcircle.render);
/*Composite.create({
    label: 'Mwheel',
    parent:engine.world
});//轮复合体*/
/*mwheel[1]=Composite.create({
    label: 'Mwheel',
    parent:engine.world
});*/
//Composite.add(mwheel2,[wsjx2,wcircle2,mcst2])

var acst = [];
var bcst = [];
//bcst=bcst.concat(connectAB(mubox0,dpen,{x:-30,y:0},0.4))
//var wsjx2=Composite.allBodies(mwheel2)[0]
//bcst=bcst.concat(connectAB(febox0,wsjx2,{x:0,y:20},0.4))

//添加所有物品到world里
//Composite.add(engine.world, [mubox0, febox0, pig0,egg0,we,mwheel2, dpen]);//stack,mwheel
Composite.add(engine.world, ground)
//Composite.add(engine.world, acst.concat(bcst))
Composite.add(engine.world, bodyss)


//Composite.add(engine.world,[softBody,spring])

//运行(渲染)renderer
Render.run(render);
//创建runner
var runner = Runner.create();
//运行engine
Runner.run(runner, engine);

//Engine.run(engine);
//Render.run(render);


class Scene {
  offset = { x: 0, y: 0 }; // 拖动偏移
  curOffset = { x: 0, y: 0 }; // 记录上一次的偏移量
  x = 0; // 记录鼠标点击Canvas时的横坐标
  y = 0; // 记录鼠标点击Canvas时的纵坐标
  touchOffset2 = { x: 0, y: 0 };// 记录第二指触摸点击Canvas时的坐标
  mousePosition = { x: 0, y: 0 };
  maxScale = 8;
  minScale = 0.4;
  scaleStep = 0.2;
  scale = 1;
  preScale = 1;
  isMove = 0;

  constructor(element=render.canvas, options = {
    width: render.options.width,
    height: render.options.height
  }) {
    this.canvas = element;
    this.width = options.width;
    this.height = options.height;
    this.canvas.width = options.width;
    this.canvas.height = options.height;
    this.ctx = this.canvas.getContext('2d');
    
    this.onMousedown = this.onMousedown.bind(this);
    this.onMousemove = this.onMousemove.bind(this);
    this.onMouseup = this.onMouseup.bind(this);
    this.canvas.addEventListener('mousedown', this.onMousedown);
    this.onMousewheel = this.onMousewheel.bind(this);
    this.canvas.addEventListener('mousewheel', this.onMousewheel);
    
    this.onTouchstart=this.onTouchstart.bind(this);
    this.onTouchmove=this.onTouchmove.bind(this);
    this.onTouchend=this.onTouchend.bind(this);
    this.canvas.addEventListener('touchstart', this.onTouchstart);
  }

  //鼠标
  onMousedown(e) {
    if (e.button === 0) {
      // 鼠标左键
      this.x = e.x;
      this.y = e.y
      window.addEventListener('mousemove', this.onMousemove);
      window.addEventListener('mouseup', this.onMouseup);
      //logs(this.x)
    }
  }

  onMousemove(e) {
   this.offset.x = this.curOffset.x + (e.x - this.x);
   this.offset.y = this.curOffset.y + (e.y - this.y);

   //this.paint();
   
   let changex=render.canvas.offsetWidth/render.options.width;
   let changey=render.canvas.offsetHeight/render.options.height;
   lookat(-(e.x - this.x)/changex, -(e.y - this.y)/changey, 0);
   this.x=e.x;
   this.y=e.y;
  }

  onMouseup() {
    this.curOffset.x = this.offset.x;
    this.curOffset.y = this.offset.y;
    //logs(this.curOffset.x)
    window.removeEventListener('mousemove', this.onMousemove);
    window.removeEventListener('mouseup', this.onMouseup);
    this.remember();
  }

  onMousewheel(e) {
    try{
    e.preventDefault();
  logs(e.wheelDelta)
    this.mousePosition.x = e.offsetX; // 记录当前鼠标点击的横坐标
    this.mousePosition.y = e.offsetY; // 记录当前鼠标点击的纵坐标
    if (e.wheelDelta > 0) {
      // 放大
      this.scale = parseFloat((this.scaleStep + this.scale).toFixed(2)); // 解决小数点运算丢失精度的问题
      if (this.scale > this.maxScale) {
        this.scale = this.maxScale;
        return;
      }
    } else {
      // 缩小
      this.scale = parseFloat((this.scale - this.scaleStep).toFixed(2)); // 解决小数点运算丢失精度的问题
      if (this.scale < this.minScale) {
        this.scale = this.minScale;
        return;
      }
    }
  
    this.offset.x = this.mousePosition.x - ((this.mousePosition.x - this.offset.x) * this.scale) / this.preScale;
    this.offset.y = this.mousePosition.y - ((this.mousePosition.y - this.offset.y) * this.scale) / this.preScale;
    //lookat(this.offset.x,this.offset.y,this.scale)
    lookat(0,0,-e.wheelDelta/Math.abs(e.wheelDelta)*parseFloat((this.scaleStep).toFixed(2)))
  
    //this.ctx.translate(this.offset.x, this.offset.y);
    //this.ctx.scale(this.scale, this.scale);
    this.preScale = this.scale;
    this.curOffset.x = this.offset.x;
    this.curOffset.y = this.offset.y;
    }catch(e){logs(e)}
    logs(0)
  }

  // paint() {
    // this.clear();
    // this.ctx.translate(this.offset.x, this.offset.y);
    // this.ctx.scale(this.scale, this.scale);
    // this.draw();
  // }


  //触摸屏
  onTouchstart(e) {
    //e.preventDefault();
    this.x = e.targetTouches[0].pageX;
    this.y = e.targetTouches[0].pageY;
    if(e.targetTouches[1]){
      this.touchOffset2.x=e.targetTouches[1].pageX;
      this.touchOffset2.y=e.targetTouches[1].pageY;
    }
    this.canvas.addEventListener('touchmove', this.onTouchmove);
    this.canvas.addEventListener('touchend', this.onTouchend);
  }
  
  onTouchmove(e){
    //e.preventDefault();
    let changex=render.canvas.offsetWidth/render.options.width;
    let changey=render.canvas.offsetHeight/render.options.height;
    if(e.targetTouches[1]){
      lookat(0,0,(Math.sqrt(Math.pow((this.x-this.touchOffset2.x)/changex,2) + Math.pow((this.y-this.touchOffset2.y)/changey,2)) / Math.sqrt(Math.pow((e.targetTouches[0].pageX-e.targetTouches[1].pageX)/changex,2) + Math.pow((e.targetTouches[0].pageY-e.targetTouches[1].pageY)/changey,2))),true);
      this.x = e.targetTouches[0].pageX;
      this.y = e.targetTouches[0].pageY;
      this.touchOffset2.x=e.targetTouches[1].pageX;
      this.touchOffset2.y=e.targetTouches[1].pageY;
    }else{
      lookat(-(e.targetTouches[0].pageX - this.x)/changex, -(e.targetTouches[0].pageY - this.y)/changey, 0);
      this.x = e.targetTouches[0].pageX;
      this.y = e.targetTouches[0].pageY;
    }
    this.isMove=1;
    //this.offset.x = this.curOffset.x + (e.targetTouches[0].pageX - this.x);
    //this.offset.y = this.curOffset.y + (e.targetTouches[0].pageY - this.y);
    //this.paint();
  }
  
  onTouchend(){
    this.curOffset.x = this.offset.x;
    this.curOffset.y = this.offset.y;
    window.removeEventListener('touchmove', this.onTouchmove);
    window.removeEventListener('touchend', this.onTouchend);
    this.remember();
    if(this.isMove===0){
      
    }else{this.isMove=0;}
  }
  
  draw() {
      //none  
  }

  clear() {
    this.canvas.width = this.width;
  }

  paint() {
    //this.clear();
    //this.ctx.translate(this.offset.x, this.offset.y);
    //this.draw();
    lookat(this.offset.x, this.offset.y,0)
  }
  
  remember() {
    localStorage.slookat=slookat.x+","+slookat.y;
  }
}new Scene();


var slookat={
x: render.options.width/2,
y: render.options.height/2,
size:1,
body:undefined,
cx:0,
cy:0
}
if(localStorage.slookat){
slookat.x=Number(localStorage.slookat.split(",")[0]);
slookat.y=Number(localStorage.slookat.split(",")[1]);
lookat(0,0,0);
}
slookat.body=pig0;
function lookat(x,y,csize,csizex){
  if(csizex){
    if(slookat.size*csize>1&&slookat.size*csize<50){
      slookat.size*=csize;
    }else if(slookat.size*csize<1){slookat.size=1}
    else if(slookat.size*csize>50){slookat.size=50}
  }else if(slookat.size+csize>0.5&&slookat.size+csize<50){
    slookat.size+=csize;
  }
  let size=slookat.size;
  if(dgbyid("check").checked){
  slookat.cx+=x*size;
  slookat.cy+=y*size;
  }else{
  slookat.x+=x*size;
  slookat.y+=y*size;
  }
  Render.lookAt(render, {
    min: { x: slookat.x-render.options.width/2*size, y: slookat.y-render.options.height/2*size },
    max: { x: slookat.x+render.options.width/2*size, y: slookat.y+render.options.height/2*size }
  });
}
function followthings(){
slookat.x=slookat.body.position.x+slookat.cx;
slookat.y=slookat.body.position.y+slookat.cy;
lookat(0,0,0)
}
Events.on(runner, "beforeUpdate", function(){
  if(dgbyid("check").checked){followthings()}
  let ctx=render.canvas.getContext("2d");
  ctx.font="25px Arial";
  ctx.textAlign="start";
  let filltexts=[
    "雀斑猪速度: "+Math.round(pig0.speed*10)/10,
    "雀斑猪位置: ("+Math.round(pig0.position.x/100)+","+Math.round(pig0.position.y/100)+")",
    "雀斑猪角度: "+Math.round(pig0.angle/Math.PI*180*10)/10,
    "雀斑猪角速度: "+Math.round(pig0.angularSpeed*10)/10,
    "视野大小: "+Math.round(slookat.size*5*100)/100,
    "视野位置: ("+Math.round(slookat.x/100)+","+Math.round(slookat.y/100)+")",
  ];
  for(var i=0;i<filltexts.length;i++){
    ctx.fillText(filltexts[i], 50, i*25+125);
  }
});
render.canvas.ondblclick=function(){
  dgbyid("check").checked=(!dgbyid("check").checked);
  slookat.cx=0;
  slookat.cy=0;
}

function boom(){
Events.on(engine, 'collisionStart', function(event) {
    var pairs = event.pairs;
    
    for (var i = 0, j = pairs.length; i != j; ++i) {
        var pair = pairs[i];

        if (pair.bodyA === bodyss[0]) {
            //pair.bodyB.render.strokeStyle = colorA;
            //Body.applyForce( pair.bodyB, {x: thebody.position.x, y: thebody.position.y}, {x:m*Math.cos(n), y:m*Math.sin(n)});
            Body.applyForce( pair.bodyB, {x: pair.bodyA.position.x, y: pair.bodyA.position.y}, {x: pair.bodyA.position.x, y: pair.bodyA.position.y});
        } else if (pair.bodyB === bodyss[0]) {
            //pair.bodyA.render.strokeStyle = colorA;
        }
    }
});
}




dgbyid("bu1").addEventListener('click', function () {
    //Body.scale( mubox0, 1.5, 1.2);//放大
    //doing()
    //Composite.move(mwheel,wsjx,engine.world)
    //Composite.remove(mwheel,mcst)
    //Matter.Body.setStatic(body, true)
    //myVar=nwnw
    //lookat(0,0,0.1)
});
dgbyid("bu2").addEventListener('click', function () {//旋转
    Body.rotate( pig0, Math.PI/180*45);
});
dgbyid("bu3").addEventListener('click', function () {//移动
    Body.translate( mubox0, {x: 40, y: -20});
});
dgbyid("bu4").addEventListener('click', function () {//移动速度
    Body.setVelocity( mubox0, {x: 00, y: -20});
    Body.setVelocity( febox0, {x: 00, y: 20});
    Body.setVelocity( pig0, {x: 10, y: -10});
});
dgbyid("bu5").addEventListener('click', function () {//旋转速度
    Body.setAngularVelocity( Composite.allBodies(wheel)[1], Math.PI/180*40);
    //Body.setAngularVelocity( mubox0, Math.PI/6);
});
dgbyid("bu6").addEventListener('click', function () {//施加力向右
    //addforce(dpen,0.44);
    addvelocity(dpen,100);
    //Body.applyForce( obja, {x: obja.position.x, y: obja.position.y}, {x: 0.44, y: 0});
});
dgbyid("bu7").addEventListener('click', function () {//向上力
    addforce(pig0,-0.44);
});
dgbyid("bu8").addEventListener('click', function () {//摩擦
  pig0.friction = 0.05;
  pig0.frictionAir = 0.0005;
  pig0.restitution = 0.9;
});
dgbyid("bu9").addEventListener('click', function () {//摩擦
  pig0.friction = 0.1;
  pig0.frictionAir = 0.001;
  pig0.restitution = 0;
});
function addforce(thebody,m){
    let n=thebody.angle;
    Body.applyForce( thebody, {x: thebody.position.x, y: thebody.position.y}, {x:m*Math.cos(n), y:m*Math.sin(n)});
}
function addvelocity(thebody,m){
  try{let n=thebody.angle;Body.setVelocity( thebody, {x:m*Math.cos(n), y:m*Math.sin(n)});}catch(e){logs(e)}
}

function logs(e){
dgbyid("log").innerHTML+=e+", ";
}

function doing(){
//Body.rotate( pig0, Math.PI/2);
setTimeout('doing()',100)
}

</script>

</body>
</html>